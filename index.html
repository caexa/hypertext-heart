<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hypertext Heart — Vanishing Signal</title>
  <style>
    :root{ --ink:#f2f2f2; --rose:#ff4da6; --rose-soft:#ff80c0; --aqua:#80ffea; --bg0:#000; }
    html,body{height:100%; margin:0;}
    body{ background: var(--bg0); color:var(--ink); font-family:"Georgia", serif;
          line-height:1.9; padding:8% 18%; font-size:1.25rem; overflow:hidden; }

    .pulse-word{ color:var(--rose); text-shadow:0 0 4px var(--rose);
                 animation: heartbeat-color 1s infinite alternate; }
    @keyframes heartbeat-color{
      0%{ color: var(--rose); text-shadow:0 0 4px var(--rose);}
      50%{ color:#ff80c0; text-shadow:0 0 12px #ff80c0;}
      100%{ color: var(--rose); text-shadow:0 0 4px var(--rose);}
    }

    #poem{transition: opacity .5s ease;} .hidden{opacity:0;}
    .link{color:var(--rose); text-decoration:none; cursor:pointer;}
    .link:hover{color:var(--rose-soft); text-shadow:0 0 12px var(--rose);}
    .alt{position:relative;}
    .alt::after{ content:attr(data-alt); position:absolute; left:50%; bottom:110%;
                 transform: translateX(-50%) translateY(-6px); font-size:.9rem;
                 color:#ffb6c1; opacity:0; pointer-events:none; white-space:nowrap;
                 text-shadow:0 0 2px #fff; transition: opacity .2s, transform .2s; }
    .alt:hover::after{ opacity:1; transform: translateX(-50%) translateY(-2px); }

    .glitch{ position:relative; display:inline-block;}
    .glitch::before,.glitch::after{ content:attr(data-text); position:absolute; left:0; top:0; opacity:.55;}
    .glitch::before{ color:var(--rose);}
    .glitch::after{ color:var(--aqua); }

    .center{text-align:center; margin-top:18vh; color:#aaa;}
    .center .big{font-size:1.6rem;} .muted{color:#777;}
    .broken404{ color:#555; font-family:monospace; }
  </style>
</head>
<body>

<div id="poem" class="hidden">
  I love you <span class="link alt pulse-word"
  data-alt="where silence leans into your breath"
  onclick="nextPage('here')">here</span>.
</div>

<audio id="beat" preload="metadata" loop>
  <source src="heartbeat.mp3" type="audio/mpeg">
</audio>
<audio id="stat" preload="metadata" loop>
  <source src="static.mp3" type="audio/mpeg">
</audio>

<script>
// --------- poem logic ---------
const PAGES = {
 "here":`I love you here—<span class="alt pulse-word" data-alt="attention cradled in light">where</span>
 <span class="link alt pulse-word" data-alt="sound that carries memory" onclick="nextPage('echo')">echo</span>
 wears the mask of <span class="link alt pulse-word" data-alt="a promise stitched in pixels" onclick="nextPage('permanence')">permanence</span>.`,
 "echo":`You said <span class="glitch pulse-word" data-text="forever">forever</span>,
 what reached me was not your voice but its
 <span class="link alt pulse-word" data-alt="reverberation through the hollows" onclick="nextPage('decay')">reverb</span>.`,
 "permanence":`Permanence is a museum label pinned to air.
 Stones flake. Servers fail. Even vows become
 <span class="link alt pulse-word" data-alt="soft dust, fading with time" onclick="nextPage('decay')">dust</span>.`,
 "decay":`What remains is a hyperlink that <span class="glitch pulse-word" data-text="already broke">already broke</span>,
 a name eroded to <span class="alt pulse-word" data-alt="tiny fragments of memory">pixels</span>.
 If you still want an ending, try to <span class="link alt pulse-word" data-alt="treading softly over lost signals" onclick="nextPage('end')">continue</span>.`,
 "end":`<div class="center broken404">
   <div class="big glitch" data-text="404: love not found">404: love not found</div>
 </div>`,
 "gone":`<div class="center broken404">
   <div class="big">410: gone</div>
   <div class="muted">neglect writes the last line<br/>refresh will not restore what attention forgot</div>
 </div>`
};

const poemEl=document.getElementById('poem');
function nextPage(key){
  poemEl.classList.add('hidden');
  setTimeout(()=>{
    poemEl.innerHTML=PAGES[key];
    poemEl.classList.remove('hidden');
  },150);
}

// Idle fade logic
let idleMs=0, hidden=false, hardIdleMs=0;
const HIDE_AFTER=700, DEAD_AFTER=10000;
let secretDone = false;
function onMove(){
  idleMs=0; hardIdleMs=0;
  if(hidden){poemEl.classList.remove('hidden'); hidden=false;}
}
document.addEventListener('mousemove',onMove);
document.addEventListener('touchmove',onMove,{passive:true});
function tick(){
  idleMs+=200; hardIdleMs+=200;
  if(idleMs>HIDE_AFTER && !hidden){poemEl.classList.add('hidden'); hidden=true;}
  if(hardIdleMs>=DEAD_AFTER && !secretDone){
    poemEl.classList.add('hidden');
    setTimeout(()=>{
      poemEl.innerHTML=PAGES.gone;
      poemEl.classList.remove('hidden');
    },150);
    secretDone=true;
    return;
  }
  setTimeout(tick,200);
}
tick();

// --------- audio logic ---------
const heartbeat = document.getElementById('beat');
const staticSound = document.getElementById('stat');

heartbeat.loop = true;
staticSound.loop = true;
heartbeat.volume = 0;  // start silent
staticSound.volume = 0;

let started = false;
let ended = false;
let idleTimer = 0;

function startAudio() {
  if (started) return;
  started = true;
  heartbeat.volume = 0.45;
  heartbeat.currentTime = 0;
  heartbeat.play().catch(e=>console.log('Play failed', e));
}

// idle fade down
function audioTick(){
  if (ended) return;
  idleTimer += 200;
  if (idleTimer > HIDE_AFTER) {
    heartbeat.volume = 0.08; // down when idle
  }
  setTimeout(audioTick,200);
}
audioTick();

// reset idle + bring volume up when moving
function audioOnMove(){
  idleTimer = 0;
  if (started) heartbeat.volume = 0.45;
}
document.addEventListener('mousemove', audioOnMove);
document.addEventListener('touchmove', audioOnMove,{passive:true});

// start audio on first explicit gesture
['click','keydown','touchstart'].forEach(evt=>{
  document.addEventListener(evt, ()=> startAudio(), {once:true});
});

// switch to static at 404
const contentObserver = new MutationObserver(()=>{
  if (poemEl.querySelector('.broken404')) {
    ended = true;
    heartbeat.pause();
    staticSound.currentTime = 0;
    staticSound.volume = 0.22;
    staticSound.play().catch(()=>{});
  }
});
contentObserver.observe(poemEl,{childList:true,subtree:true});
</script>

</body>
</html>
